---
title: IOT疯狂踩坑
date: 2022-04-21 08:53:36
tags:
    - iot

---

<!--more-->

#	记录一下CVE-2020-3331踩的坑

## 环境

​		首先，环境绝对绝对绝对是最难配置的，感觉iot即使网上有那种师傅们已经弄好的漏洞文章，但是对于每个人来说并不是都可以一开始像大牛他们直接一步到位开始分析漏洞的，有很多细枝末节可能对于写文章的师傅来说是一种常识，所以没有记录，恰恰是这些琐碎的小细节（qemu里的配置、需要下载的逆向软件**bindiff**……）光是这些东西就花了我三天多的时间去网上搜集各种解决办法，自认为大学这么多年搜索引擎使用得还算可以，硬是花费了很大劲。尤其是这个**bindiff**，花了一个上午也没整明白，安装卸载来来回回已经n遍了，硬是说安装路径不对，我都尝试过各种方法，网上的解决的方案也都试了个遍，依旧不行，最后实在不会了问了问学长，学长告诉我这东西就是报错多，就不再打算在它上面浪费时间了。bindiff的效果就是能对比两个ida文件的差别，我当时想着我还不如开两个ida一个个看。**（吐槽一下：垃圾软件）**

## 固件提取

​		就拿这两天啃的思科漏洞：CVE-2020-3331来作为例子吧。前几天学长给我推了一篇文章是关于这个漏洞的详细文档的，我在手机上粗略地看了一眼，感觉挺好的，觉得拿来练手很不错，可是当我前两天配完环境后，今天花了一天的时间硬是找不到固件文件，挺离谱的。

​		像网上师傅说的一开始直接拉两条命令就已经配好环境了

```
docker pull vulshare/cve-2020-3331:lxonz
docker run -itd -P vulshare/cve-2020-3331:lxonz
```

​		照做了之后确实没有报错，而且返回了一连串很长的字符串（一开始我没看懂这是什么字符串，后面发现是docker id），接着网上师傅们就是说直接可以运行qemu环境了

```
qemu启动参数：
qemu-system-mipsel -M malta \ 
-kernel vmlinux-3.2.0-4-4kc-malta  \
-hda debian_wheezy_mipsel_standard.qcow2 \
-append "root=/dev/sda1 console=tty0 nokalsr" \
-net nic -net tap,ifname=tap0,script=no,downscript=no -nographic
```

![image-20220421201321258](https://s2.loli.net/2022/04/21/4h5ouJHLnjBAFd1.png)

​		可是我还是一顿报错，说我缺少内核文件，在网上搜集无果，我就又回头去看上面两句代码。在搜集资料过后，我还想着我的固件文件为什么找不到，尝试过搜集命令：`find -name "bin" 、 grep -r "bin"` 都找不到我想要的固件文件，我直接愣了，这我该去哪分析啊？况且网上的漏洞分析前提都是漏洞文件放入ida之后开始的，我直接卡在了找不到文件**（坑！）**没办法，我只能进docker看看

`sudo docker exec -it dockerid /bin/bash`

进去之后也没有固件

![image-20220421201607871](https://s2.loli.net/2022/04/21/FJ87543bH2wZW6B.png)

​		只有这三个东西，其余两个还是qemu的环境配置，没法办法试着运行sh文件

![image-20220421201945646](https://s2.loli.net/2022/04/21/s5SklMduTq4nr9K.png)

啥也没有，实在不会了，去问了学长，学长也告诉我了几个办法看看能不能找点东西出来。

### ps -A 

​		这命令可以查看docker里面所有东西

![image-20220421202155441](https://s2.loli.net/2022/04/21/AcSdHTuiW7lVPMK.png)

​		虽然我这次没提出什么东西，但是我觉得也算收获一种提取命令，学长告诉我这个docker应该是已经配置好环境可以直接运行固件ip的

### netstat -anpt

![image-20220421202326234](https://s2.loli.net/2022/04/21/VGcspBLDH5gOPb4.png)

​		上网搜了搜这个命令：列出系统上所有的网络套接字连接情况，包括 tcp, udp 以及 unix 套接字，另外它还能列出处于监听状态（即等待接入请求）的套接字。如果你想确认系统上的 Web 服务有没有起来，你可以查看80端口有没有打开。

​		可以看到开启了80端口，就当我以为还有希望复现这个漏洞时。我访问了虚拟机ip所有的80端口均为关闭状态。**（坑！）**

后续不肯放弃，在学长指示下又在docker里面尝试了 curl、nc、wget等方式访问127.0.0.1：80

![image-20220421202958048](https://s2.loli.net/2022/04/21/ahLQlEf4d6iPcYC.png)

都不行，唉，东西没给全，环境没搭好，我觉得这个iot挺坑的。

# 总结

​		虽然这次花费了不少功夫在复现这个CVE上也没能如愿复刻网上大牛们的漏洞复现，但是还是有所收获，了解了一些固件逆向软件bindiff的使用及作用，也了解挺多qemu方面的知识，更多的是对固件iot漏洞有了更深层次的认识，还有很感谢有学长的帮助，又教会了我几条好用的命令（大佬太猛了！！！），今天又被学长推荐去学习学习FirmAE（说是一个很好用的工具），有大佬指路的感觉真的真的比一个人在盲目地乱学好太多了，今天也不早了，明天开始学习FirmAE~

